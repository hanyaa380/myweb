function e(e){throw new Error("[PlayerCore error]: "+e)}function t(e){console.warn("[PlayerCore warn]: "+e)}class i{constructor(e){Object.defineProperty(this,"e",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"SongIdList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"CurrentSongId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"IsPlaying",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"SongIdMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"PlayMode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"IsMute",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultIconPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{defaultIconPath:t}=e||{};this.e=document.createElement("audio"),this.e.volume=.1,this.SongIdList=[],this.SongIdMap={},this.PlayMode=1,this.CurrentSongId="?",this.IsPlaying=!1,this.IsMute=!1,this.defaultIconPath=t||undefined}_AppendSongByIndex(e,t){this.SongIdList.splice(t,0,e.id),this.SongIdMap[e.id.toString()]=e}_AppendCheck(t){t?(-1!==this.SongIdList.indexOf(t.id)||this.SongIdMap[t.id])&&e("The song which append to queue has repeat id."):e("AppendSong function had been call but without song info.")}QuerySongInfo(e){return this.SongIdMap[e.toString()]}RemoveSong(t){!function(t){void 0===t&&e("Expect other value but got undefined")}(t);const i=this.QuerySongInfo(t);if(i){if(this.CurrentSongId===i.id)if(1===this.SongIdList.length)this.e.pause(),this.e.src="",this.CurrentSongId="?";else{let e=this.SongIdList.indexOf(i.id);e===this.SongIdList.length-1?e=0:e++;const t=this.SongIdMap[this.SongIdList[e]];t&&(this.CurrentSongId=t.id,this.e.src=t.src)}delete this.SongIdMap[i.id],this.SongIdList.splice(this.SongIdList.indexOf(i.id),1)}}AppendSong(e,t){this._AppendCheck(e);let i=this.SongIdList.length;if("string"==typeof t){const e=this.QuerySongInfo(t);if(e){const t=this.SongIdList.indexOf(e.id);t<i&&t>=0&&(i=t+1)}}this._AppendSongByIndex(e,i)}AppendSongOnHead(e){this._AppendCheck(e),this._AppendSongByIndex(e,-1)}AppendSongOnTail(e){this._AppendCheck(e),this._AppendSongByIndex(e,this.SongIdList.length)}AppendSongList(e){e.forEach((e=>{this.AppendSongOnTail(e)}))}UpdateSongPosition(t){t.length!=this.SongIdList.length&&e("Update Song Position size is not equal with old list size");const i=new Set(this.SongIdList.map((e=>e)));if(t.forEach((e=>{i.delete(e)})),i.size){const t=[];i.forEach((e=>{t.push(e)})),e("New list has unknown id: "+t.toString())}this.SongIdList=t}PlaySelectSong(e){const i=this.SongIdMap[e];-1!==this.SongIdList.indexOf(e)?(i&&(this.e.src=i.src,this.CurrentSongId=e),this.Play()):t(`Song's id: '${e}' is not in the id list or it's not corrent number.`)}NextSong(){const e=this.SongIdList.indexOf(this.CurrentSongId);let t=0;e!==this.SongIdList.length-1&&(t=e+1),this.PlaySelectSong(this.SongIdList[t])}PrevSong(){const e=this.SongIdList.indexOf(this.CurrentSongId);let t=this.SongIdList.length-1;0!==e&&(t=e-1),this.PlaySelectSong(this.SongIdList[t])}SwitchMute(){this.IsMute=!this.e.muted,this.e.muted=this.IsMute}SwitchPlayMode(e){let t=1;"object"==typeof e&&(t=parseInt(e.currentTarget.getAttribute("data-mode-id"))),4===t?t=1:t++,this.PlayMode=t}async Play(){0===this.e.src.length&&this.PlaySelectSong(this.SongIdList[0]),await this.e.play(),this.IsPlaying=!0}Pause(){this.e.pause(),this.IsPlaying=!1}ChangeVolume(e){this.e.volume=e<0&&e<=1?0:e>1?1:e}ChangeCurrentSongTime(e){"number"==typeof e?this.e.currentTime=e:t("Type of time expect number but got: "+typeof e)}}function n(e){e||(e=0);let t=parseInt(e/60+""),i=parseInt(e%60+"");return t<10&&(t="0"+t),i<10&&(i="0"+i),`${t}:${i}`}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},a="object"==typeof o&&o&&o.Object===Object&&o,d="object"==typeof self&&self&&self.Object===Object&&self,l=a||d||Function("return this")(),c=l,u=function(){return c.Date.now()},h=/\s/;var g=function(e){for(var t=e.length;t--&&h.test(e.charAt(t)););return t},f=/^\s+/;var p=function(e){return e?e.slice(0,g(e)+1).replace(f,""):e},v=l.Symbol,m=v,S=Object.prototype,w=S.hasOwnProperty,y=S.toString,b=m?m.toStringTag:void 0;var I=function(e){var t=w.call(e,b),i=e[b];try{e[b]=void 0;var n=!0}catch(e){}var o=y.call(e);return n&&(t?e[b]=i:delete e[b]),o},P=Object.prototype.toString;var L=I,M=function(e){return P.call(e)},C=v?v.toStringTag:void 0;var T=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C&&C in Object(e)?L(e):M(e)},x=function(e){return null!=e&&"object"==typeof e};var O=p,E=s,_=function(e){return"symbol"==typeof e||x(e)&&"[object Symbol]"==T(e)},k=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,A=/^0o[0-7]+$/i,W=parseInt;var $=s,N=u,H=function(e){if("number"==typeof e)return e;if(_(e))return NaN;if(E(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=E(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=O(e);var i=j.test(e);return i||A.test(e)?W(e.slice(2),i?2:8):k.test(e)?NaN:+e},R=Math.max,U=Math.min;var D=function(e,t,i){var n,o,r,s,a,d,l=0,c=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var i=n,r=o;return n=o=void 0,l=t,s=e.apply(r,i)}function f(e){var i=e-d;return void 0===d||i>=t||i<0||u&&e-l>=r}function p(){var e=N();if(f(e))return v(e);a=setTimeout(p,function(e){var i=t-(e-d);return u?U(i,r-(e-l)):i}(e))}function v(e){return a=void 0,h&&n?g(e):(n=o=void 0,s)}function m(){var e=N(),i=f(e);if(n=arguments,o=this,d=e,i){if(void 0===a)return function(e){return l=e,a=setTimeout(p,t),c?g(e):s}(d);if(u)return clearTimeout(a),a=setTimeout(p,t),g(d)}return void 0===a&&(a=setTimeout(p,t)),s}return t=H(t)||0,$(i)&&(c=!!i.leading,r=(u="maxWait"in i)?R(H(i.maxWait)||0,t):r,h="trailing"in i?!!i.trailing:h),m.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=d=o=a=void 0},m.flush=function(){return void 0===a?s:v(N())},m},B=s;var q=r((function(e,t,i){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return B(i)&&(n="leading"in i?!!i.leading:n,o="trailing"in i?!!i.trailing:o),D(e,t,{leading:n,maxWait:t,trailing:o})}));const X=e=>{const t=e.exp?document.querySelector(e.exp):e.el;if(!t)return;let i=0,n=0;const o=t.clientWidth;const r=q((e=>{let r=e.clientX-i,s=e.clientY-n;const a=window.innerWidth,d=window.innerHeight;var l,c;r<=-o?r=-o:r+t.offsetWidth>=a+o&&(r=a+o-t.offsetWidth),s<=0?s=0:s+t.offsetHeight>=d&&(s=d-t.offsetHeight),l=r,c=s,t.style.setProperty("left",l+"px"),t.style.setProperty("top",c+"px")}),16);return e.el.addEventListener("mousedown",(e=>{i=e.clientX-t.offsetLeft,n=e.clientY-t.offsetTop,window.addEventListener("mousemove",r),window.addEventListener("mouseup",(function e(){window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",e)}))})),()=>{}},z=/left|right/,Q=e=>{const t=e.el,i=()=>{t.offsetLeft>window.innerWidth/2?(t.setAttribute("class",`${t.getAttribute("class")?.replace(z,"")} right`),t.style.setProperty("left",window.innerWidth-t.clientWidth+"px")):(t.setAttribute("class",`${t.getAttribute("class")?.replace(z,"")} left`),t.style.setProperty("left","0px"))};return window.addEventListener("mouseup",(()=>setTimeout((()=>{i()}),20))),window.addEventListener("resize",i),()=>{}};let V;const F="CoreWrapper";let Y;class Z{constructor(e){Object.defineProperty(this,"PlayerCore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"e",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{rootElement:t,ad:o=!0,initRight:r=!1,defaultIconPath:s=""}=e||{};this.PlayerCore=PetiteVue.reactive(new i(e)),this.e=this.PlayerCore.e,V=this.PlayerCore,o&&console.log("Vue-Mini-Player powered by: https://github.com/QingXia-Ela/vue-mini-player");const a=document.createElement("div");a.setAttribute("id","CorePlayer"),a.innerHTML='<div v-scope id="CoreWrapper" v-wrapper-adsorb @mouseup="wrapperMouseUp" @mousedown="clearHiddenTimer"\n  @vue:mounted="onMounted"\n  :class="`player_module ${dragging ? \'dragging\': \'\'} ${onRight ? \'right\' : \'left\'} ${hidden && !hover ? \'hidden\' : \'\'}`">\n  <div class="left_arrow" @click="clickShow">\n    <i class="iconfont icon-24gl-arrowLeft3"></i>\n  </div>\n  <div class="operate_box" @mousedown="wrapperMouseDown" @mouseenter="wrapperMouseEnter"\n    @mouseleave="wrapperMouseLeave">\n    <div class="left_img"\n      :style="`background-image: url(${currentSongInfo.img ? currentSongInfo.img  : defaultIconPath});`">\n    </div>\n    <div class="right_operate">\n      <div class="song_name" v-draggable="#CoreWrapper">\n        <span class="name">{{ currentSongInfo.name }}</span>\n        <span class="time">{{ mediaCurrentTime }}/{{ mediaDuration }}</span>\n      </div>\n      <div class="operation_button">\n        <i class="iconfont icon-24gl-volumeZero" v-if="store.IsMute" @click="store.SwitchMute"></i>\n        <i class="iconfont icon-24gl-volumeMiddle" v-else @click="store.SwitchMute"></i>\n        <i class="iconfont icon-24gl-previousCircle" @click="store.PrevSong"></i>\n        <i class="iconfont icon-24gl-pauseCircle" v-if="store.IsPlaying" @click="CorePause"></i>\n        <i class="iconfont icon-24gl-playCircle" v-else @click="CorePlay"></i>\n        <i class="iconfont icon-24gl-nextCircle" @click="store.NextSong"></i>\n        <i class="iconfont icon-24gl-arrowRight" v-if="store.PlayMode === 1" data-mode-id="1"\n          @click="store.SwitchPlayMode"></i>\n        <i class="iconfont icon-24gl-repeat2" v-else-if="store.PlayMode === 2" data-mode-id="2"\n          @click="store.SwitchPlayMode"></i>\n        <i class="iconfont icon-24gl-repeatOnce2" v-else-if="store.PlayMode === 3" data-mode-id="3"\n          @click="store.SwitchPlayMode"></i>\n        <i class="iconfont icon-24gl-shuffle" v-else @click="store.SwitchPlayMode" data-mode-id="4"></i>\n      </div>\n      <div class="slider" @click.stop.prevent>\n        <div class="track" @mousedown="jumpTime">\n          <div class="active_track" :style="`width: ${showupPrecentage}%;`"></div>\n        </div>\n        <div class="thumb" :style="`left: ${showupPrecentage}%;`"></div>\n      </div>\n    </div>\n  </div>\n  <div class="right_arrow" @click="clickShow">\n    <i class="iconfont icon-24gl-arrowRight3"></i>\n  </div>\n  <div class="show_list_button" @click="switchListShow"></div>\n  <div :class="`list_box player_module ${showList ? \'show\' : \'\'}`" @mouseenter="wrapperMouseEnter"\n    @mouseleave="wrapperMouseLeave">\n    <div class="empty_tips" v-if="store.SongIdList.length === 0">No Data :(</div>\n    <div :class="`song_item ${i.id === store.CurrentSongId ? \'current\' : \'\'}`" v-for="(i, index) in songInfoList"\n      @dblclick="CorePlaySelectSong(i.id)">\n      <div class="title">{{ i.name }}</div>\n      <div class="function_button">\n        <i class="iconfont icon-24gl-playCircle" @click="store.PlaySelectSong(i.id)"></i>\n        <i class="iconfont icon-24gl-trash2" @click="store.RemoveSong(i.id)"></i>\n      </div>\n    </div>\n  </div>\n</div>',a.querySelector("#CoreWrapper")?.setAttribute("style",r?"right: 0;":"left: 0;"),t?"string"==typeof t?document.querySelector(t)?.appendChild(a):t.appendChild(a):document.body.appendChild(a);const d=PetiteVue.createApp({store:V,dragging:!1,onRight:r,hidden:!0,hover:!1,currentTime:0,duration:0,showupPrecentage:0,showList:!1,sliding:!1,slidingTime:0,defaultIconPath:s,onMounted(){const{e:e}=V;e.addEventListener("timeupdate",(()=>{this.sliding||(this.CurrentTime=e.currentTime,this._UpdateShowPrecentage(this.CurrentTime/this.duration))})),e.addEventListener("loadedmetadata",(()=>{this.sliding||(this.duration=e.duration)})),this.store.e.addEventListener("ended",(()=>{const{SongIdList:e,CurrentSongId:t,PlayMode:i}=this.store,n=e.indexOf(t);switch(i){case 1:n!==e.length&&V.NextSong();break;case 2:default:V.NextSong();break;case 3:V.Play();break;case 4:let i=parseInt(e.length*Math.random()+"");for(;i===t;)i=parseInt(e.length*Math.random()+"");V.PlaySelectSong(e[i])}}))},get currentPrecentage(){return(100*this.currentTime).toFixed(2)},get currentSongInfo(){const e=V.SongIdMap[V.CurrentSongId];return e||{name:"_(:з」∠)_"}},get mediaDuration(){return n(this.duration)},get mediaCurrentTime(){return this.sliding?n(this.slidingTime):n(this.CurrentTime)},get songInfoList(){const e=[];for(const t of V.SongIdList)e.push(V.SongIdMap[t]);return e},clearHiddenTimer(){clearTimeout(Y)},startTimer(){Y&&this.clearHiddenTimer(),Y=setTimeout((()=>{this.hidden=!0,this.hover=!1,this.showList=!1,this.clearHiddenTimer()}),8e3)},wrapperMouseDown(){this.dragging=!0,this.hidden=!1},wrapperMouseUp(){this.dragging=!1;const e=document.getElementById(F);e&&(e.offsetLeft>window.innerWidth/2?this.onRight=!0:this.onRight=!1)},wrapperMouseEnter(){this.hover=!0,this.clearHiddenTimer()},wrapperMouseLeave(){this.hover=!1,this.startTimer()},clickShow(e){clearTimeout(Y),this.hidden=!this.hidden,this.hidden&&(this.showList=!1),e.preventDefault(),this.startTimer()},_UpdateShowPrecentage(e){e>1?e=1:e<0&&(e=0),this.showupPrecentage=(100*e).toFixed(2),this.slidingTime=this.duration*e},jumpTime(e){if(isNaN(this.store.e.duration))return;const t=e.currentTarget;let i=e.offsetX/t.clientWidth;this._UpdateShowPrecentage(i),this.sliding=!0,i*=t.clientWidth;const n=e=>{const n=document.getElementById(F);i=e.clientX-n.offsetLeft-t.clientWidth,i+=this.onRight?25:85,this._UpdateShowPrecentage(i/t.clientWidth)},o=()=>{this.store.e.currentTime=i/t.clientWidth*this.duration,this.sliding=!1,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",o)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",o)},switchListShow(){this.showList=!this.showList},async CorePlay(){try{await V.Play()}catch(e){console.log(e)}},CorePause(){V.Pause()},CorePlaySelectSong(e){V.PlaySelectSong(e)}});d.directive("draggable",X),d.directive("wrapper-adsorb",Q),d.mount(a)}}export{Z as default};
